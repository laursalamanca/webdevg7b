<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BeatBox Home</title>

  <!-- Tailwind for styling -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    /* Enable dark mode support in Tailwind */
    tailwind.config = { darkMode: "class" }
  </script>

  <!-- Decide theme before paint so the page does not flash -->
  <script>
    if (
      localStorage.theme === "dark" ||
      (!("theme" in localStorage) &&
        window.matchMedia("(prefers-color-scheme: dark)").matches)
    ) {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }
  </script>
</head>

<body class="bg-white dark:bg-slate-900 text-slate-900 dark:text-white min-h-screen">

  <!-- =============================== -->
  <!--           TOP NAVBAR            -->
  <!-- =============================== -->
  <nav class="bg-white dark:bg-black/80 backdrop-blur border-b border-gray-200 dark:border-gray-700">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="relative flex h-16 items-center justify-between">

        <!-- Brand logo and name -->
        <div class="flex items-center space-x-2">
          <span class="text-xl font-bold dark:text-white">BeatBox</span>
          <img src="images/music-box.png" class="h-8" alt="BeatBox logo" />
        </div>

        <!-- Mobile button to open or close nav links -->
        <div class="flex sm:hidden">
          <button id="menu-toggle" class="p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-md">
            <!-- three line icon when menu closed -->
            <svg id="menu-open-icon" class="block h-6 w-6" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16" />
            </svg>
            <!-- x icon when menu open -->
            <svg id="menu-close-icon" class="hidden h-6 w-6" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        <!-- Desktop navigation links -->
        <div class="hidden sm:flex sm:space-x-4">
          <a href="index.html" class="nav-link">Home</a>
          <a href="about.html" class="nav-link">About</a>
          <a href="subscriptiontiers.html" class="nav-link">Subscription Tiers</a>
          <a href="howitworks.html" class="nav-link">How It Works</a>
          <a href="featuredartist.html" class="nav-link">Featured Artist</a>
          <a href="checkoutpage.html" class="nav-link">Checkout</a>
          <a href="contact.html" class="nav-link">Contact Us</a>
        </div>

        <!-- Right side controls for font size and theme -->
        <div class="flex items-center space-x-2">
          <!-- Font size controls -->
          <div class="flex items-center rounded-full border border-slate-300 dark:border-slate-700 bg-slate-100 dark:bg-slate-800 px-2 py-1 text-xs">
            <button id="font-decrease" class="px-2 text-sm font-semibold">A</button>
            <span class="mx-1 h-4 w-px bg-slate-300 dark:bg-slate-600"></span>
            <button id="font-increase" class="px-2 text-base font-semibold">A</button>
          </div>

          <!-- Theme toggle button -->
          <button id="theme-toggle"
            class="rounded-md px-3 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600">
            ðŸŒ—
          </button>
        </div>

      </div>
    </div>

    <!-- Mobile navigation menu content -->
    <div id="mobile-menu" class="hidden sm:hidden px-2 pb-3 space-y-1">
      <a href="index.html" class="mobile-link">Home</a>
      <a href="about.html" class="mobile-link">About</a>
      <a href="subscriptiontiers.html" class="mobile-link">Subscription Tiers</a>
      <a href="howitworks.html" class="mobile-link">How It Works</a>
      <a href="featuredartist.html" class="mobile-link">Featured Artist</a>
      <a href="checkoutpage.html" class="mobile-link">Checkout</a>
      <a href="contact.html" class="mobile-link">Contact Us</a>
    </div>
  </nav>

  <!-- =============================== -->
  <!--           MAIN CONTENT          -->
  <!-- =============================== -->
  <main class="px-6 py-10 lg:px-12 lg:py-16 pt-20">

    <!-- Hero section with feature text and sponsor image -->
    <section class="mx-auto max-w-7xl grid gap-12 md:grid-cols-3 items-center">

      <!-- Left side hero copy -->
      <div class="space-y-6 md:col-span-2">
        <p class="inline rounded-full bg-purple-100 px-3 py-1 text-sm font-semibold text-purple-700 dark:bg-purple-900/40 dark:text-purple-200">
          Curated music boxes for rising artists
        </p>

        <h1 class="text-5xl font-bold leading-tight">
          BeatBox brings exclusive music, playlists, and merch straight to your door.
        </h1>

        <p class="text-lg max-w-xl text-slate-600 dark:text-slate-300">
          Every month, BeatBox curates a box with merch, digital playlists, and behind the scenes artist content.
        </p>

        <!-- Call to action buttons -->
        <div class="flex flex-wrap gap-4">
          <a href="subscriptiontiers.html"
            class="rounded-lg bg-purple-600 px-5 py-3 text-sm font-semibold text-white shadow hover:bg-purple-700">
            View subscription tiers
          </a>

          <a href="featuredartist.html"
            class="text-sm font-semibold text-purple-700 dark:text-purple-300">
            Meet the featured artist
          </a>
        </div>

        <!-- Two short feature blurbs -->
        <div class="grid gap-4 text-sm text-slate-600 dark:text-slate-300 sm:grid-cols-2">
          <div>
            <p class="font-semibold dark:text-slate-100">Hand picked every month</p>
            <p>Our team listens to many records and demos so you can discover new artists early.</p>
          </div>

          <div>
            <p class="font-semibold dark:text-slate-100">Built for fans and creators</p>
            <p>Support rising artists while getting exclusive content and merch in every BeatBox.</p>
          </div>
        </div>
      </div>

      <!-- Right side image section -->
      <div class="flex justify-end items-start">
        <img src="images/67.png"
             class="w-48 sm:w-60 lg:w-72 rounded-2xl shadow-lg object-cover"
             alt="BeatBox featured artist" />
      </div>

    </section>

    <!-- Simple reviews row -->
    <section class="mt-20">
      <div class="mx-auto max-w-7xl">
        <h2 class="text-3xl font-bold text-center mb-8">What listeners are saying</h2>

        <div class="grid gap-8 md:grid-cols-3">

          <article class="review-card">
            <p class="stars">â˜…â˜…â˜…â˜…â˜…</p>
            <p class="review-title">BeatBox put me on to new artists instantly.</p>
            <p class="review-user">Maya from Boston</p>
          </article>

          <article class="review-card">
            <p class="stars">â˜…â˜…â˜…â˜…â˜…</p>
            <p class="review-title">The drops feel custom made for me.</p>
            <p class="review-user">Jordan from New York</p>
          </article>

          <article class="review-card">
            <p class="stars">â˜…â˜…â˜…â˜…â˜…</p>
            <p class="review-title">My fanbase grew because of BeatBox.</p>
            <p class="review-user">Nova independent artist</p>
          </article>

        </div>
      </div>
    </section>

  </main>

  <!-- =============================== -->
  <!--              CHATBOT            -->
  <!-- =============================== -->

  <!-- Floating button with unread badge -->
  <button id="chatbot-btn"
    class="fixed bottom-6 right-6 bg-purple-600 text-white px-4 py-3 rounded-full shadow-lg hover:bg-purple-700 z-50 flex items-center space-x-2">
    <span>ðŸ’¬ Chat</span>
    <span id="chat-unread"
          class="hidden text-xs bg-red-500 text-white rounded-full px-2 py-0.5">
      0
    </span>
  </button>

  <!-- Chat panel container -->
  <div id="chatbot-panel"
    class="hidden fixed bottom-20 right-6 w-80 md:w-[28rem] bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-xl shadow-xl p-4 z-50">

    <!-- Header with title and controls -->
    <div class="flex items-center justify-between mb-2">
      <div class="flex flex-col">
        <p class="font-bold text-slate-800 dark:text-white">
          BeatBox Help Bot
        </p>
        <p id="chat-subtitle" class="text-xs text-slate-500 dark:text-slate-400">
          Ask me about subscriptions, shipping, and more.
        </p>
      </div>
      <div class="flex items-center space-x-2">
        <!-- Size toggle button for compact or large view -->
        <button id="chat-size-toggle"
          class="text-xs px-2 py-1 rounded border border-slate-300 dark:border-slate-600 text-slate-600 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700">
          Large
        </button>
        <!-- Close button -->
        <button id="chatbot-close"
          class="text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-white text-lg leading-none px-1">
          Ã—
        </button>
      </div>
    </div>

    <!-- Two column layout on larger screens -->
    <div class="md:grid md:grid-cols-[2fr,1.3fr] md:gap-3">

      <!-- Left column: chat log and input -->
      <div class="flex flex-col">
        <div class="relative">
          <!-- Chat scroll area -->
          <div id="chat-log"
               class="h-44 md:h-48 overflow-y-auto text-sm mb-3 p-2 border border-slate-200 dark:border-slate-700 rounded bg-slate-50 dark:bg-slate-900">
            <!-- Helper text with many sample questions filled from JavaScript -->
            <p class="mb-2 text-xs text-slate-500 dark:text-slate-400">
              Try asking things like:
              <span id="helper-questions"></span>
            </p>
          </div>

          <!-- Scroll to bottom pill -->
          <button id="scroll-bottom-btn"
                  class="hidden absolute bottom-4 right-4 text-xs bg-purple-600 text-white px-3 py-1 rounded-full shadow">
            New messages
          </button>
        </div>

        <!-- Typing indicator -->
        <p id="typing-indicator"
           class="hidden text-[0.7rem] text-slate-500 dark:text-slate-400 mb-1">
          Bot is typing...
        </p>

        <!-- Quick suggestion chips -->
        <div class="flex flex-wrap gap-2 mb-2">
          <button class="suggest-chip" data-question="What are your subscription tiers">
            Tiers
          </button>
          <button class="suggest-chip" data-question="How much does BeatBox cost each month">
            Pricing
          </button>
          <button class="suggest-chip" data-question="How does BeatBox shipping work">
            Shipping
          </button>
          <button class="suggest-chip" data-question="Who is the featured artist right now">
            Featured artist
          </button>
          <button class="suggest-chip" data-question="How do I track my BeatBox order">
            Track order
          </button>
          <button class="suggest-chip" data-question="How do I contact BeatBox support">
            Contact support
          </button>
        </div>

        <!-- Input row -->
        <div class="flex items-center space-x-2">
          <input id="chat-input" 
                 class="flex-1 p-2 text-sm border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-900"
                 placeholder="Ask a question..." />
          <button id="chat-clear"
                  class="text-xs px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-slate-600 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700">
            Clear
          </button>
        </div>
      </div>

      <!-- Right column: quick topics -->
      <div class="hidden md:flex md:flex-col md:border-l md:border-slate-200 md:dark:border-slate-700 md:pl-3 md:space-y-2 mt-3 md:mt-0">
        <p class="text-xs font-semibold text-slate-500 dark:text-slate-300 mb-1">
          Quick topics
        </p>
        <button class="topic-btn" data-topic="subscriptions">
          Subscriptions and plans
        </button>
        <button class="topic-btn" data-topic="shipping">
          Shipping and delivery
        </button>
        <button class="topic-btn" data-topic="billing">
          Billing and payments
        </button>
        <button class="topic-btn" data-topic="artists">
          Featured artists
        </button>
        <button class="topic-btn" data-topic="account">
          Account settings
        </button>
        <button class="topic-btn" data-topic="support">
          Support and contact
        </button>
      </div>
    </div>
  </div>


  <!-- =============================== -->
  <!--            INLINE JS            -->
  <!-- =============================== -->
  <script>
    /* =========================================
       Theme toggle for light and dark
       ========================================= */
    const themeToggle = document.getElementById("theme-toggle");
    if (themeToggle) {
      themeToggle.addEventListener("click", () => {
        const isDark = document.documentElement.classList.toggle("dark");
        localStorage.theme = isDark ? "dark" : "light";
      });
    }

    /* =========================================
       Mobile navigation open and close
       ========================================= */
    const menuToggle = document.getElementById("menu-toggle");
    const mobileMenu = document.getElementById("mobile-menu");
    const openIcon = document.getElementById("menu-open-icon");
    const closeIcon = document.getElementById("menu-close-icon");

    if (menuToggle && mobileMenu && openIcon && closeIcon) {
      menuToggle.addEventListener("click", () => {
        const hidden = mobileMenu.classList.toggle("hidden");
        openIcon.classList.toggle("hidden", !hidden);
        closeIcon.classList.toggle("hidden", hidden);
      });
    }

    /* =========================================
       Highlight the current page in the nav
       ========================================= */
    const path = window.location.pathname.split("/").pop() || "index.html";
    document.querySelectorAll("nav a").forEach((a) => {
      if (a.getAttribute("href") === path) {
        a.classList.add("bg-gray-100", "dark:bg-gray-800", "text-blue-600");
      }
    });

    /* =========================================
       Font size adjuster
       ========================================= */
    const inc = document.getElementById("font-increase");
    const dec = document.getElementById("font-decrease");
    let scale = 1;

    function applyScale() {
      document.documentElement.style.fontSize = 16 * scale + "px";
    }

    if (inc && dec) {
      inc.addEventListener("click", () => {
        scale = Math.min(1.3, scale + 0.05);
        applyScale();
      });

      dec.addEventListener("click", () => {
        scale = Math.max(0.85, scale - 0.05);
        applyScale();
      });
    }

    /* =========================================
       Chatbot references
       ========================================= */
    const chatbotBtn = document.getElementById("chatbot-btn");
    const chatbotPanel = document.getElementById("chatbot-panel");
    const chatbotClose = document.getElementById("chatbot-close");
    const chatInput = document.getElementById("chat-input");
    const chatLog = document.getElementById("chat-log");
    const chatClearBtn = document.getElementById("chat-clear");
    const helperQuestionsSpan = document.getElementById("helper-questions");
    const typingIndicator = document.getElementById("typing-indicator");
    const scrollBottomBtn = document.getElementById("scroll-bottom-btn");
    const chatSizeToggle = document.getElementById("chat-size-toggle");
    const chatUnread = document.getElementById("chat-unread");
    const chatSubtitle = document.getElementById("chat-subtitle");
    const topicButtons = document.querySelectorAll(".topic-btn");
    const suggestChips = document.querySelectorAll(".suggest-chip");

    const CHAT_HISTORY_KEY = "beatboxChatHistory";
    const CHAT_USER_KEY = "beatboxUserName";
    const CHAT_OPENED_KEY = "beatboxChatOpenedOnce";

    let isUserScrollingUp = false;
    let unreadCount = 0;
    let botTypingTimeout = null;

    /* =========================================
       Helper questions (one thousand total)
       ========================================= */

    const baseQuestions = [
      "What are your subscription tiers",
      "How do I start a BeatBox subscription",
      "Can I buy only one BeatBox",
      "Does my BeatBox plan renew every month",
      "How do I choose my BeatBox plan",
      "Can I upgrade my BeatBox plan later",
      "Can I downgrade my BeatBox plan later",
      "How long is each BeatBox subscription term",
      "Can I pause my BeatBox subscription",
      "Can I skip a BeatBox shipment",
      "How do I restart my BeatBox subscription",
      "Can I move from Starter Vibes to Headliner",
      "Can I move from Headliner to Starter Vibes",
      "Can I have more than one BeatBox subscription",
      "Can I create a BeatBox gift subscription",
      "What is included in the Starter Vibes tier",
      "What is included in the Crowd Favorite tier",
      "What is included in the Headliner tier",
      "Do all tiers include digital playlists",
      "Do all tiers include physical merch",
      "Do all tiers get access to the featured artist content",
      "Can I see a comparison chart of BeatBox tiers",
      "Which BeatBox tier is best for new fans",
      "Which BeatBox tier is best for collectors",
      "Which BeatBox tier has the most merch",
      "How much does BeatBox cost each month",
      "Do you charge a sign up fee for BeatBox",
      "Do you charge tax on BeatBox orders",
      "Do BeatBox prices change based on location",
      "Do BeatBox prices change during promotions",
      "Do you accept debit cards for BeatBox",
      "Do you accept credit cards for BeatBox",
      "Can I use PayPal to pay for BeatBox",
      "Can I pay for BeatBox with Apple Pay",
      "Can I pay for BeatBox with Google Pay",
      "Can I use a prepaid card for BeatBox",
      "How do I update my BeatBox payment method",
      "When is my BeatBox payment processed each month",
      "What happens if my BeatBox payment fails",
      "Do you send a reminder before my BeatBox renews",
      "Can I change my billing date for BeatBox",
      "Do you offer student discounts for BeatBox",
      "Do you offer first time BeatBox customer discounts",
      "Do you have BeatBox bundle discounts",
      "Can I use a promo code on my BeatBox order",
      "Where do I enter a BeatBox promo code",
      "Can I use more than one promo code on BeatBox",
      "Can I apply a promo code after I place my BeatBox order",
      "How long does BeatBox shipping take",
      "How much is BeatBox shipping",
      "Is BeatBox shipping included in the price",
      "Do you offer free shipping for BeatBox",
      "Do you ship BeatBox to my state",
      "Do you ship BeatBox to rural addresses",
      "Do you ship BeatBox to PO boxes",
      "Do you ship BeatBox to college dorms",
      "Do you ship BeatBox to work addresses",
      "Which carrier do you use to ship BeatBox",
      "How soon does my BeatBox ship after billing",
      "Do all BeatBox orders include tracking",
      "How do I track my BeatBox order",
      "Where can I find my BeatBox tracking number",
      "What if my BeatBox tracking link does not update",
      "What if my BeatBox shows delivered but I did not get it",
      "What if my BeatBox package is stolen",
      "What if my BeatBox is lost in transit",
      "What if my BeatBox arrives late",
      "What if my BeatBox arrives damaged",
      "Can I get a replacement BeatBox",
      "How do I report a damaged BeatBox",
      "Do you ship BeatBox internationally",
      "Which countries do you ship BeatBox to",
      "Do you plan to expand BeatBox international shipping",
      "Are customs fees included in BeatBox orders",
      "Will I have to pay import fees for BeatBox",
      "Do you offer country specific BeatBox versions",
      "How do I create a BeatBox account",
      "How do I log in to my BeatBox account",
      "How do I reset my BeatBox password",
      "How do I change my BeatBox email address",
      "How do I change my BeatBox profile name",
      "How do I update my BeatBox billing address",
      "How do I update my BeatBox shipping address",
      "How do I update my BeatBox clothing size",
      "How do I update my BeatBox music preferences",
      "How do I delete my BeatBox account",
      "How do I cancel my BeatBox subscription",
      "Can I cancel BeatBox online",
      "How late can I cancel BeatBox before renewal",
      "What happens after I cancel BeatBox",
      "Do I still get my final BeatBox after I cancel",
      "How do I skip a BeatBox month",
      "Can I skip multiple BeatBox months in a row",
      "What comes inside each BeatBox",
      "Do BeatBox boxes include posters",
      "Do BeatBox boxes include stickers",
      "Do BeatBox boxes include digital downloads",
      "Do BeatBox boxes include behind the scenes content",
      "Do BeatBox boxes include interviews",
      "Do BeatBox boxes ever include signed items",
      "Are BeatBox items exclusive to BeatBox customers",
      "Can I buy past BeatBox items",
      "Who is the current BeatBox featured artist",
      "How often do you change the BeatBox featured artist",
      "How do you select the BeatBox featured artist",
      "Do you work with independent artists for BeatBox",
      "Can I suggest an artist for BeatBox",
      "How do I access my BeatBox digital playlists",
      "Can I share my BeatBox playlist with friends",
      "Do you offer BeatBox gift subscriptions",
      "How do BeatBox gift subscriptions work",
      "Do you offer holiday themed BeatBox boxes",
      "Do you offer limited edition BeatBox drops",
      "How do I contact BeatBox customer support",
      "What is the BeatBox support email",
      "What are BeatBox customer support hours",
      "What is your BeatBox refund policy",
      "Where can I see past BeatBox featured artists",
      "What is BeatBox in simple terms",
      "What can this BeatBox chat bot help me with",
      "How do I clear this BeatBox chat"
    ];

    const extraQuestionsNeeded = 1000 - baseQuestions.length;

    const extraQuestions = Array.from({ length: extraQuestionsNeeded }, (_, index) => {
      const n = index + 1;
      return "I have a BeatBox question number " + n;
    });

    const sampleQuestions = baseQuestions.concat(extraQuestions);

    if (helperQuestionsSpan) {
      helperQuestionsSpan.textContent = sampleQuestions.join(", ");
    }

    /* =========================================
       Chat history and persistence
       ========================================= */

    function loadChatHistory() {
      try {
        const raw = localStorage.getItem(CHAT_HISTORY_KEY);
        if (!raw) return [];
        return JSON.parse(raw) || [];
      } catch (e) {
        return [];
      }
    }

    function saveChatHistory(history) {
      try {
        localStorage.setItem(CHAT_HISTORY_KEY, JSON.stringify(history));
      } catch (e) {
        // ignore
      }
    }

    function getUserName() {
      try {
        return localStorage.getItem(CHAT_USER_KEY) || "";
      } catch (e) {
        return "";
      }
    }

    function setUserName(name) {
      try {
        localStorage.setItem(CHAT_USER_KEY, name);
      } catch (e) {
        // ignore
      }
    }

    let chatHistory = loadChatHistory();
    let storedName = getUserName();

    function formatTime(date) {
      const h = date.getHours();
      const m = date.getMinutes().toString().padStart(2, "0");
      const suffix = h >= 12 ? "PM" : "AM";
      const hour12 = ((h + 11) % 12) + 1;
      return hour12 + ":" + m + " " + suffix;
    }

    function appendMessageToDom(sender, text, time) {
      if (!chatLog) return;
      const wrapper = document.createElement("div");
      wrapper.classList.add("mb-2");

      const label = sender === "user" ? "You" : "Bot";

      const meta = document.createElement("div");
      meta.classList.add("flex", "items-baseline", "justify-between", "mb-0.5");
      const nameSpan = document.createElement("span");
      nameSpan.classList.add("text-xs", sender === "user" ? "text-slate-600" : "text-purple-700");
      nameSpan.innerText = label;
      const timeSpan = document.createElement("span");
      timeSpan.classList.add("text-[0.65rem]", "text-slate-400");
      timeSpan.innerText = time;
      meta.appendChild(nameSpan);
      meta.appendChild(timeSpan);

      const body = document.createElement("div");
      if (sender === "user") {
        body.classList.add("px-2", "py-1", "rounded", "bg-slate-200", "dark:bg-slate-700");
      } else {
        body.classList.add("px-2", "py-1", "rounded", "bg-purple-100", "dark:bg-purple-900/40", "text-purple-900", "dark:text-purple-100");
      }
      body.innerText = text;

      wrapper.appendChild(meta);
      wrapper.appendChild(body);

      chatLog.appendChild(wrapper);
    }

    function renderChatHistory() {
      if (!chatLog) return;
      chatLog.innerHTML = "";
      if (chatHistory.length === 0) {
        const p = document.createElement("p");
        p.classList.add("mb-2", "text-xs", "text-slate-500", "dark:text-slate-400");
        p.innerText = "Welcome to BeatBox Help Bot. Ask anything about subscriptions, shipping, billing, featured artists, or type clear to reset.";
        chatLog.appendChild(p);
      } else {
        chatHistory.forEach(msg => {
          appendMessageToDom(msg.sender, msg.text, msg.time);
        });
      }
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    renderChatHistory();

    function addMessage(sender, text) {
      const time = formatTime(new Date());
      const entry = { sender, text, time };
      chatHistory.push(entry);
      saveChatHistory(chatHistory);
      appendMessageToDom(sender, text, time);

      if (!isPanelVisible() || isUserScrollingUp) {
        unreadCount += 1;
        updateUnreadBadge();
      }

      if (!isUserScrollingUp && chatLog) {
        chatLog.scrollTop = chatLog.scrollHeight;
      }
    }

    function updateUnreadBadge() {
      if (!chatUnread) return;
      if (unreadCount > 0 && !isPanelVisible()) {
        chatUnread.classList.remove("hidden");
        chatUnread.innerText = unreadCount;
      } else {
        chatUnread.classList.add("hidden");
      }
    }

    function resetUnread() {
      unreadCount = 0;
      updateUnreadBadge();
    }

    function isPanelVisible() {
      return chatbotPanel && !chatbotPanel.classList.contains("hidden");
    }

    /* =========================================
       Typing indicator with delay
       ========================================= */

    function showTyping() {
      if (!typingIndicator) return;
      typingIndicator.classList.remove("hidden");
    }

    function hideTyping() {
      if (!typingIndicator) return;
      typingIndicator.classList.add("hidden");
    }

    function botAnswerWithDelay(text) {
      showTyping();
      if (botTypingTimeout) {
        clearTimeout(botTypingTimeout);
      }
      botTypingTimeout = setTimeout(() => {
        hideTyping();
        addMessage("bot", text);
      }, 600);
    }

    /* =========================================
       Name detection
       ========================================= */

    function detectAndSaveName(text) {
      const lower = text.toLowerCase();
      const marker = "my name is ";
      const index = lower.indexOf(marker);
      if (index !== -1) {
        const rawName = text.substring(index + marker.length).trim();
        if (rawName.length > 0) {
          const cleanName = rawName.split(" ")[0].replace(/[^\w]/g, "");
          if (cleanName) {
            setUserName(cleanName);
            storedName = cleanName;
            botAnswerWithDelay("Nice to meet you " + cleanName + ". I will use your name in this chat.");
          }
        }
      }
    }

    /* =========================================
       Main question handler
       ========================================= */

    function handleQuestion(rawText) {
      const q = rawText.trim();
      const qLower = q.toLowerCase();

      if (!q) return;

      detectAndSaveName(q);

      if (qLower === "clear" || qLower === "reset" || qLower === "cls") {
        chatHistory = [];
        saveChatHistory(chatHistory);
        if (chatLog) {
          chatLog.innerHTML = "";
        }
        botAnswerWithDelay("Chat cleared. Ask me anything about your BeatBox subscription.");
        return;
      }

      if (
        qLower.includes("hi") ||
        qLower.includes("hello") ||
        qLower.includes("hey") ||
        qLower.includes("yo")
      ) {
        const namePart = storedName ? " " + storedName : "";
        botAnswerWithDelay("Hi" + namePart + ". I am the BeatBox Help Bot. I can help with pricing, shipping, subscription tiers, featured artists, and general account questions.");
        return;
      }

      if (qLower.includes("what is beatbox") || (qLower.includes("beatbox") && qLower.includes("what"))) {
        botAnswerWithDelay("BeatBox is a monthly music subscription box for rising artists. Each box includes exclusive playlists, merch, and behind the scenes content curated around a featured artist.");
        return;
      }

      if (qLower.includes("tier") || qLower.includes("plan") || qLower.includes("subscription")) {
        botAnswerWithDelay("BeatBox offers three planned tiers. Starter Vibes with core digital content and small merch, Crowd Favorite with extra merch and more exclusive tracks, and Headliner with premium items like apparel and limited prints.");
        return;
      }

      if (qLower.includes("price") || qLower.includes("cost") || qLower.includes("how much")) {
        botAnswerWithDelay("Prices can shift with promotions and location, but Starter Vibes is planned around ten per month, Crowd Favorite around twenty five per month, and Headliner around forty per month.");
        return;
      }

      if (qLower.includes("shipping") || qLower.includes("deliver") || qLower.includes("delivery") || qLower.includes("ship")) {
        botAnswerWithDelay("Most BeatBox orders are prepared shortly after billing and are planned to arrive in about three to five business days once they ship. A tracking link is sent by email when your box leaves our facility.");
        return;
      }

      if (qLower.includes("international") || qLower.includes("outside") || qLower.includes("country")) {
        botAnswerWithDelay("Right now BeatBox is focused on customers within the United States. Expanding into additional countries is something we plan to explore as we grow.");
        return;
      }

      if (qLower.includes("featured artist") || qLower.includes("artist of the month") || qLower.includes("who is the artist")) {
        botAnswerWithDelay("Each month we spotlight a different featured artist. You can see the current selection on the Featured Artist page in the main navigation.");
        return;
      }

      if (qLower.includes("cancel") || qLower.includes("stop") || qLower.includes("end my subscription")) {
        botAnswerWithDelay("You can cancel your BeatBox plan in your account subscription settings. After you cancel, you keep access through the end of your current billing period.");
        return;
      }

      if (qLower.includes("pause") || qLower.includes("hold") || qLower.includes("skip a month")) {
        botAnswerWithDelay("Account settings are planned to support pause and skip options so you can take a short break without fully cancelling.");
        return;
      }

      if (qLower.includes("contact") || qLower.includes("email") || qLower.includes("support") || qLower.includes("help desk")) {
        botAnswerWithDelay("If you need more help you can visit the Contact page in the navigation or email support at beatboxsound dot com.");
        return;
      }

      if (qLower.includes("track") || qLower.includes("tracking") || qLower.includes("where is my box") || qLower.includes("order status")) {
        botAnswerWithDelay("When your BeatBox ships you get an email with tracking details so you can follow your package until it arrives.");
        return;
      }

      if (qLower.includes("student") || qLower.includes("discount") || qLower.includes("promo")) {
        botAnswerWithDelay("BeatBox may offer student pricing and promo codes through campus events, email campaigns, and partner promotions. Keep an eye on our newsletter for current offers.");
        return;
      }

      if (qLower.includes("help") || qLower.includes("what can you do") || qLower.includes("options")) {
        botAnswerWithDelay("I can help explain BeatBox subscription tiers, pricing, shipping, featured artists, cancelling or pausing, and how to contact support. You can also type clear to reset the chat.");
        return;
      }

      botAnswerWithDelay("I am not sure about that one yet. Try asking about pricing, subscription tiers, shipping, featured artists, cancelling or pausing, order tracking, or type clear to reset the chat.");
    }

    /* =========================================
       Chat input listeners and clear
       ========================================= */

    function sendUserQuestion(text) {
      const q = text.trim();
      if (!q) return;
      addMessage("user", q);
      handleQuestion(q);
    }

    if (chatInput && chatLog) {
      chatInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && chatInput.value.trim() !== "") {
          const q = chatInput.value.trim();
          chatInput.value = "";
          sendUserQuestion(q);
        }
      });
    }

    if (chatClearBtn) {
      chatClearBtn.addEventListener("click", () => {
        chatHistory = [];
        saveChatHistory(chatHistory);
        if (chatLog) {
          chatLog.innerHTML = "";
        }
        botAnswerWithDelay("Chat cleared. Ask me anything about your BeatBox subscription.");
      });
    }

    /* Suggestion chips */
    suggestChips.forEach(chip => {
      chip.addEventListener("click", () => {
        const question = chip.getAttribute("data-question") || "";
        if (question) {
          sendUserQuestion(question);
        }
      });
    });

    /* Topic buttons with richer answers */
    const topicAnswers = {
      subscriptions: "BeatBox subscriptions are built around three planned tiers. Starter Vibes focuses on digital content and small merch, Crowd Favorite adds more exclusive tracks and physical items, and Headliner includes premium merch like apparel and limited prints. Plans are designed to renew monthly and eventually support skip and pause options so you stay in control.",
      shipping: "BeatBox aims to ship boxes within a few days of your billing date. Once your box leaves our facility you receive an email with a tracking link. Most boxes are planned to arrive in about three to five business days, depending on the carrier and location. As we expand, we will explore international shipping options beyond the United States.",
      billing: "BeatBox billing is planned to run on a recurring monthly schedule. You will be able to update your payment method, billing address, and preferred plan from your account settings. Promotional prices, student discounts, and bundle offers can be applied with promo codes during checkout when available.",
      artists: "Each BeatBox cycle centers on a featured artist. That artist helps shape the playlists, stories, and merch inside the box. We focus on rising artists and independent talent while also exploring partnerships with labels, festivals, and brands. You will be able to discover new artists early and follow them beyond the box.",
      account: "From your BeatBox account you will be able to manage your subscription, update shipping and billing details, change your plan, adjust your music preferences, and control email settings. Future updates may include profile badges, listening stats, and rewards for long time supporters.",
      support: "If something is not right with your BeatBox order you can reach out through the Contact page or by using the support email listed there. When you contact support it helps to include your order number, the email tied to your account, and a short description of what happened so the team can respond quickly."
    };

    topicButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const topic = btn.getAttribute("data-topic");
        const qText = "Tell me about " + (topic || "BeatBox");
        addMessage("user", qText);
        const answer = topicAnswers[topic] || "BeatBox offers flexible subscriptions, curated boxes, and direct support so you can discover new artists and manage your plan easily.";
        botAnswerWithDelay(answer);
      });
    });

    /* =========================================
       Chat panel visibility and size
       ========================================= */

    function openChatPanel(fromAuto) {
      if (!chatbotPanel) return;
      chatbotPanel.classList.remove("hidden");
      resetUnread();

      if (chatLog) {
        chatLog.scrollTop = chatLog.scrollHeight;
      }

      if (!fromAuto && sessionStorage.getItem(CHAT_OPENED_KEY) !== "true") {
        sessionStorage.setItem(CHAT_OPENED_KEY, "true");
      }
    }

    function closeChatPanel() {
      if (!chatbotPanel) return;
      chatbotPanel.classList.add("hidden");
    }

    if (chatbotBtn && chatbotPanel) {
      chatbotBtn.addEventListener("click", () => {
        if (isPanelVisible()) {
          closeChatPanel();
        } else {
          openChatPanel(false);
        }
      });
    }

    if (chatbotClose && chatbotPanel) {
      chatbotClose.addEventListener("click", () => {
        closeChatPanel();
      });
    }

    /* Size toggle between normal and larger */
    if (chatSizeToggle && chatbotPanel) {
      chatSizeToggle.addEventListener("click", () => {
        const isLarge = chatbotPanel.classList.toggle("md:w-[32rem]");
        chatSizeToggle.textContent = isLarge ? "Compact" : "Large";
      });
    }

    /* Auto open once per session on page load */
    window.addEventListener("load", () => {
      const alreadyOpened = sessionStorage.getItem(CHAT_OPENED_KEY) === "true";
      if (!alreadyOpened) {
        openChatPanel(true);
        sessionStorage.setItem(CHAT_OPENED_KEY, "true");
      }
    });

    /* Close with Escape key */
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && isPanelVisible()) {
        closeChatPanel();
      }
    });

    /* Track scroll to show new message pill */
    if (chatLog && scrollBottomBtn) {
      chatLog.addEventListener("scroll", () => {
        const nearBottom = chatLog.scrollHeight - chatLog.scrollTop - chatLog.clientHeight < 10;
        isUserScrollingUp = !nearBottom;
        if (nearBottom) {
          scrollBottomBtn.classList.add("hidden");
          resetUnread();
        } else if (unreadCount > 0) {
          scrollBottomBtn.classList.remove("hidden");
        }
      });

      scrollBottomBtn.addEventListener("click", () => {
        chatLog.scrollTop = chatLog.scrollHeight;
        isUserScrollingUp = false;
        scrollBottomBtn.classList.add("hidden");
        resetUnread();
      });
    }

    /* Update subtitle with name if stored */
    if (storedName && chatSubtitle) {
      chatSubtitle.textContent = "Hi " + storedName + ". Ask me anything about your BeatBox subscription.";
    }
  </script>

  <!-- =============================== -->
  <!--         EXTRA STYLES            -->
  <!-- =============================== -->
  <style>
    .nav-link {
      padding: 0.5rem 0.75rem;
      font-size: 0.875rem;
      font-weight: 500;
      color: black;
      border-radius: 0.375rem;
    }
    .nav-link:hover {
      background-color: rgba(31,41,55,0.05);
    }
    .dark .nav-link {
      color: white;
    }

    .mobile-link {
      padding: 0.5rem 0.75rem;
      font-size: 1rem;
      font-weight: 500;
      border-radius: 0.375rem;
      display: block;
    }
    .mobile-link:hover {
      background-color: rgba(31,41,55,0.05);
    }

    .review-card {
      border-radius: 1rem;
      padding: 1rem;
      border: 1px solid #e2e8f0;
      background-color: white;
    }
    .dark .review-card {
      background-color: #0f172a;
      border-color: #374151;
    }

    .stars {
      color: #f59e0b;
      font-size: 1.125rem;
    }

    .suggest-chip {
      font-size: 0.7rem;
      padding: 0.25rem 0.5rem;
      border-radius: 999px;
      border: 1px solid #cbd5f5;
      background-color: #eef2ff;
      color: #4c1d95;
      cursor: pointer;
      white-space: nowrap;
    }
    .dark .suggest-chip {
      border-color: #4c1d95;
      background-color: #312e81;
      color: #e0e7ff;
    }

    .suggest-chip:hover {
      background-color: #e0e7ff;
    }
    .dark .suggest-chip:hover {
      background-color: #4338ca;
    }

    .topic-btn {
      font-size: 0.75rem;
      padding: 0.4rem 0.5rem;
      border-radius: 0.5rem;
      border: 1px solid #e5e7eb;
      text-align: left;
      background-color: #f9fafb;
      color: #111827;
    }
    .topic-btn:hover {
      background-color: #e5e7eb;
    }
    .dark .topic-btn {
      border-color: #4b5563;
      background-color: #111827;
      color: #e5e7eb;
    }
    .dark .topic-btn:hover {
      background-color: #374151;
    }
  </style>

</body>
</html>
